datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        String   @id
  email     String   @unique
  handle    String?  @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Follow {
  followerId String
  followeeId String
  createdAt  DateTime @default(now())

  @@id([followerId, followeeId])
  @@index([followeeId])
}

model Block {
  blockerId String
  blockeeId String
  createdAt DateTime @default(now())

  @@id([blockerId, blockeeId])
}

model Clan {
  id         String   @id @default(cuid())
  name       String
  slug       String   @unique
  visibility String // "public" | "private"
  coverUrl   String?
  settings   Json?
  createdBy  String
  createdAt  DateTime @default(now())
}

model ClanMember {
  clanId   String
  userId   String
  role     String // "leader" | "officer" | "member"
  status   String // "active" | "banned" | "left"
  joinedAt DateTime @default(now())

  @@id([clanId, userId])
  @@index([userId])
}

model ClanInvite {
  id        String   @id @default(cuid())
  clanId    String
  inviterId String
  inviteeId String?
  token     String   @unique
  expiresAt DateTime
  status    String // "pending" | "accepted" | "revoked" | "expired"
  createdAt DateTime @default(now())

  @@index([clanId])
}

model ClanJoinRequest {
  id          String    @id @default(cuid())
  clanId      String
  requesterId String
  status      String // "pending" | "approved" | "rejected"
  reviewedBy  String?
  reviewedAt  DateTime?
  createdAt   DateTime  @default(now())

  @@index([clanId, status])
}

model Report {
  id          String    @id @default(cuid())
  subjectType String // "message" | "clan" | "user"
  subjectId   String
  reporterId  String
  reason      String
  status      String // "open" | "resolved" | "invalid"
  createdAt   DateTime  @default(now())
  resolvedAt  DateTime?
}
