datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}



generator client {
  provider = "prisma-client-js"
}

model ConversationMember {
  conversationId String
  userId         String
  role           String   @default("member")
  joinedAt       DateTime @default(now())
  leftAt         DateTime?

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@id([conversationId, userId])
  @@index([userId, joinedAt])
  @@index([conversationId, leftAt]) // ⭐ thêm
}

model Conversation {
  id        String   @id @default(cuid())
  type      String
  clanId    String?  @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  members   ConversationMember[]
  messages  Message[]

  @@index([type]) // ⭐ optional
}


model Message {
  id             String   @id @default(cuid())
  conversationId String
  senderId       String
  content        String
  createdAt      DateTime @default(now())

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId, createdAt])
}

model ReadReceipt {
  conversationId String
  userId         String
  lastReadAt     DateTime @default(now())

  @@id([conversationId, userId])
}

model DmKey {
  key            String @id   // min(a,b):max(a,b)
  conversationId String @unique
}
